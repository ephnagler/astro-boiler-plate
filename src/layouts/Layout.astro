---
import type { SanityDocument } from "@sanity/client";
import { loadQuery } from "./../sanity/lib/load-query";
import "../styles/global.css";

const { data: siteSettings } = await loadQuery<SanityDocument>({
  query: `*[_id == "siteSettings" && !(_id in path("drafts.**"))][0]{
    siteTitle,
    liveTemplate->{
      defaultLightColorScheme->{
        backgroundColor,
        textColor,
        accentColor
      },
      defaultDarkColorScheme->{
        backgroundColor,
        textColor,
        accentColor
      }
    }
  }`,
});

const light = siteSettings?.liveTemplate?.defaultLightColorScheme;
const dark = siteSettings?.liveTemplate?.defaultDarkColorScheme;

const bgColor = light?.backgroundColor?.hex || "#ffffff";
const textColor = light?.textColor?.hex || "#000000";
const accentColor = light?.accentColor?.hex || "#007acc";

const bgColorDark = dark?.backgroundColor?.hex || "#000000";
const textColorDark = dark?.textColor?.hex || "#ffffff";
const accentColorDark = dark?.accentColor?.hex || "#007acc";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{siteSettings.siteTitle}</title>
    <script>
      import { initThemeToggle } from "./../js/theme-switch.js";
      initThemeToggle();
    </script>
    <style
      define:vars={{
        bgColor,
        bgColorDark,
        textColor,
        textColorDark,
        accentColor,
        accentColorDark,
      }}
      is:global
    >
      html {
        background-color: var(--bgColor);
        color: var(--textColor);
        .accent-color {
          color: var(--accentColor);
        }

        &[data-theme="dark"] {
          background-color: var(--bgColorDark);
          color: var(--textColorDark);
          .accent-color {
            color: var(--accentColorDark);
          }
        }
      }
    </style>
  </head>
  <body>
    <slot />
  </body>
</html>
